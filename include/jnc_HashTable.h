#pragma once

#include "jnc_DataPtrType.h"
#include "jnc_Api.h"
#include "jnc_StdLibApiSlots.h"

namespace jnc {

//.............................................................................

class StringHashTable: public IfaceHdr
{
public:
	JNC_BEGIN_TYPE ("jnc.StringHashTable", StdApiSlot_StringHashTable)
		JNC_CONSTRUCTOR (&StringHashTable::construct)
		JNC_FUNCTION ("clear",  &StringHashTable::clear)
		JNC_FUNCTION ("find", &StringHashTable::find_s)
		JNC_FUNCTION ("insert", &StringHashTable::insert)
		JNC_FUNCTION ("erase", &StringHashTable::erase)
	JNC_END_TYPE ()

public:
	rtl::StringHashTableMap <Variant>* m_hashTable;
	size_t m_count;

public:
	void
	AXL_CDECL
	construct ()
	{
		m_hashTable = AXL_MEM_NEW (rtl::StringHashTableMap <Variant>);
		m_count = 0;
	}

	void
	AXL_CDECL
	clear ()
	{
		m_hashTable->clear ();
		m_count = 0;
	}

	static
	DataPtr
	find_s (
		StringHashTable* self,
		DataPtr keyPtr
		);

	void
	AXL_CDECL
	insert (
		DataPtr keyPtr,
		Variant value
		)
	{
		(*m_hashTable) [(const char*) keyPtr.m_p] = value;
		m_count = m_hashTable->getCount ();
	}

	bool
	AXL_CDECL
	erase (DataPtr keyPtr)
	{
		return m_hashTable->eraseByKey ((const char*) keyPtr.m_p);
	}
};

//.............................................................................

class VariantHashTable: public IfaceHdr
{
public:
	JNC_BEGIN_TYPE ("jnc.VariantHashTable", StdApiSlot_VariantHashTable)
		JNC_CONSTRUCTOR (&VariantHashTable::construct)
		JNC_FUNCTION ("clear",  &VariantHashTable::clear)
		JNC_FUNCTION ("find", &VariantHashTable::find_s)
		JNC_FUNCTION ("insert", &VariantHashTable::insert)
		JNC_FUNCTION ("erase", &VariantHashTable::erase)
	JNC_END_TYPE ()

public:
	typedef rtl::HashTableMap <Variant, Variant, HashVariant, CmpVariant> VariantHashTableMap;

public:
	VariantHashTableMap* m_hashTable;
	size_t m_count;

public:
	void
	AXL_CDECL
	construct ()
	{
		m_hashTable = AXL_MEM_NEW (VariantHashTableMap);
		m_count = 0;
	}

	void
	AXL_CDECL
	clear ()
	{
		m_hashTable->clear ();
		m_count = 0;
	}

	static
	DataPtr
	find_s (
		VariantHashTable* self,
		Variant key
		);

	void
	AXL_CDECL
	insert (
		Variant key,
		Variant value
		)
	{
		(*m_hashTable) [key] = value;
		m_count = m_hashTable->getCount ();
	}

	bool
	AXL_CDECL
	erase (Variant key)
	{
		return m_hashTable->eraseByKey (key);
	}
};

//.............................................................................

} // namespace jnc
