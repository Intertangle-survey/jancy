//.............................................................................

class MyScheduler: jnc.Scheduler
{
	destruct ()
	{
		printf ("MyScheduler.destruct ()\n");
	}

	override schedule (function* func ())
	{
		printf ("+MyScheduler.schedule ()\n");
		func ();
		printf ("-MyScheduler.schedule ()\n");
	}
}

class C1
{
	destruct ()
	{
		printf ("C1.destruct ()\n");
	}

	foo ()
	{
		printf ("C1.foo ()\n");
	}
}

int main ()
{
	printf ("main ()\n");

	C1* c = new C1;
	MyScheduler* scheduler = new MyScheduler;

	weak multicast mc () = c.foo @ scheduler;

//	c = null;
	scheduler = null;

	printf ("collecting garbage...\n");	

	jnc.collectGarbage ();

	printf ("calling multicast...\n");	
	mc ();

	printf ("collecting garbage again...\n");	
	jnc.collectGarbage ();

	
	return 0;
}

//.............................................................................
